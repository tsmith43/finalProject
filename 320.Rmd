---
title: "Shark Attacks are Rising"
author: "Nadiya Klymenko, Trevor Smith"
output: html_document
---

Introduction:
In this report, we will be analyzing Shark Attack cases from 1900-2017. The original dataset includes information about if the shark attack was fatal, which activity thae person was doing when they got attacked as well as which country the attack was in. In this report we primarily focus on where the attack occurred as well as which activity was being demonstrated when the person was attacked. The purpose for this report is to give the public a better understanding of the activities that they should be careful of when visiting other countries as well as in their own home. A shark attack is dangerous and could potentially end someone's life. Being aware of what to be careful of with shark attacks is the first step to being safe. 


1. Getting Started
  We need to first download the dataset that we are planning to analyze. You can find this dataset at https://www.kaggle.com/teajay/global-shark-attacks/version/7 
 For the focus of this report, we are going to remove a lot of the original dataset that we find unnecessary. Below is the original dataset: 
 
```{r}
library(tidyverse)
library(ggplot2)

original_data <- read.csv(file="/Users/trevorsmith/Desktop/attacks.csv", na.strings=c("","NA"))

original_data
```
 
Now below is our updated dataset. We decided to split the case number into separate columns in order to extract the year and month to be used for further analysis. At first thought we split the data based on the actual date parameter. But, since there was a lot of variation amongst that column we ended up losing a lot of data points. So to prevent loss of data, we broke up the information from the Case number tab. We also kept the type of attack, the country as well as the activity found below. This dataset will be what we use for the report. 
 
```{r}
shark_data <- original_data %>% 
  separate(Case.Number, into=c("Year2", "Month", "Day"),  sep = "[.]", extra = "drop") %>%
  filter (!is.na(Day)) %>%
  filter (Year > 1900, Year < 2018) %>%
  select(Year = Year2, Month, Type, Country, Area, Activity, Injury, Fatal = Fatal..Y.N.) %>%
  arrange(Year)

shark_data<-shark_data[!(shark_data$Year=="1851" & shark_data$Month =="12"),]
shark_data <- shark_data[!(shark_data$Year=="1962,08"),]
shark_data$Year <- as.numeric(shark_data$Year)

total_attacks <- nrow(shark_data)

shark_data
```
  


2. Number of Attacks per year:

We begin our analysis by looking at the trend that time has on the number of shark attacks per year. Found below is the graph that we can use to observe how the number of attacks increase as time increases. The way we do this is by first grouping our information based on the year that it is in. By grouping it with year, we're putting all of the attacks for a given year into a group so that we can then use the n() function to count the number of values for each year that we have. After we find these values, we can place them into a ggplot of a bar graph to get a histogram of the number of attacks for each year. As you can tell from our graph below, the number of attacks each year is consistently increasing. Is there a cause for this increase? Let's further look into what could be causing this issue. 

```{r}
attacksPerYear <- shark_data %>%
  group_by(Year) %>%
  summarize(numOfAttacks = n()) %>%
  ggplot(aes(x=Year, y=numOfAttacks)) + geom_bar(stat = "identity", color = "black", fill = "navyblue") + 
    labs(title = "Total Number of Attacks Over Time", x = "Year", y = "Attacks That Year") + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) + scale_x_continuous(breaks=seq(1900, 2017, 9))

attacksPerYear
```
  
  
3. One country more than another?
  We first question this increase by asking, is there one country that is increasing faster/more than any of the other countries? We notice below that these are the top 6 countries that have impacted the total number of shark attacks throughout the years. We see this graph by first grouping our data and counting the number of rows that a certain country has. This determines the total number of attacks that a country has. 

```{r}
countryTotals <- shark_data %>%
  group_by(Country) %>%
  summarize(attacksForCountries = n()) %>%
  arrange(desc(attacksForCountries))%>%
  head() %>%
  ggplot(aes(x=Country, y=attacksForCountries)) + geom_bar(stat = "identity", color = "black", fill = "navyblue") + labs(title = "Top 6 Countries with the most number of attacks", x = "Country", y = "Number of Attacks") + geom_text(aes(label=attacksForCountries), position=position_dodge(width=0.9), vjust=-0.25)


countryTotals
```
  
  Looking at this graph we can tell that the USA has the largest number of attacks compared to Australia and South Africa. But this huge difference could purely be based on the population differences between the 6 countries. So to combat this, we can look at the different graphs individually as they progress through time. In the graph below we can see the different graphs as time progresses. We notice with the first graph that is generally difficult to compare the 6 countries. To fix this, how about we change the scaling for each of the different countries. Changing this scaling helps us see the the actualy increase and change throughout time. We notice that with each country there is a positive correlation between time and the number of attacks. What could be causing this issue? It looks as though the USA has the strongest correlation, with the steepest slope. Let's talk more about why the USA might have this steep slope. 
```{r}
countryThroughTime<- shark_data %>%
  group_by(Year, Country) %>%
  filter(Country == "USA" | Country == "AUSTRALIA" | Country == "SOUTH AFRICA" | Country == "BRAZIL" | Country == "PAPA NEW GUINEA" | Country == "BAHAMAS") %>%
  summarize(attacks = n()) %>%
  ggplot(aes(x=Year, y=attacks)) + geom_bar(stat = "identity", color = "black", fill = "navyblue")+ facet_grid(Country ~ .) + geom_smooth(method = lm, color = "pink") + labs(title = "Number of Attacks throughout Time in 6 different countries", x = "Year", y ="Total number of Attacks")

countryThroughTimeScaled<- shark_data %>%
  group_by(Year, Country) %>%
  filter(Country == "USA" | Country == "AUSTRALIA" | Country == "SOUTH AFRICA" | Country == "BRAZIL" | Country == "PAPA NEW GUINEA" | Country == "BAHAMAS") %>%
  summarize(attacks = n()) %>%
  ggplot(aes(x=Year, y=attacks)) + geom_bar(stat = "identity", color = "black", fill = "navyblue")+ facet_grid(Country ~ ., scales="free") + geom_smooth(method = lm, color = "pink") + labs(title = "Number of Attacks throughout Time in 6 different countries", x = "Year", y ="Total number of Attacks")


countryThroughTime
countryThroughTimeScaled
```
  
    
4. Why is the USA so high? Mean # of attacks, SD, Analyze how time affects the USA. 


5. What is another potential cause in the large amount of attacks in the USA? Could it be based on the activity that was performed? 
Which activity in the USA is the highest? 


As we can tell from above, we notice that time DOES OR DOES NOT have an impact on the number of attacks that we have in the country. Is there another aspect that might have a strong correlation to causing a huge increase in the number of attacks? Will the type of activity that you are doing cause an effect on the number of attacks caused? Does activity have a positive correlation to the number of incidents? Seen below is the graph for the top 6 Activities that have caused an attack in the USA. The highest number of attacks is found when someone is surfing in the USA. Let's dive deeper into the surfing activity.
```{r}

activityAttacks <- shark_data %>%
  group_by(Activity) %>%
  filter(Country =="USA") %>%
  summarize(num = n()) %>%
  arrange(desc(num)) %>%
  mutate(Activity=replace(Activity, is.na(Activity), "Unknown")) %>% 
  head() %>%
  ggplot(aes(x = Activity, y = num)) + geom_bar(stat = "identity", fill = "red") + geom_text(aes(label=num), position=position_dodge(width=0.9), vjust=-0.25) + labs(title ="Number of Attacks for a Given Activity in the USA", x = "Activity", y = "Number of Attacks")

activityAttacks

```
  
  

6. Is this activity a huge issue in other countries?
```{r}

dots <- aus_shark_data %>%
  filter(Country == "USA" | Country == "AUSTRALIA" | Country == "SOUTH AFRICA" | Country == "BRAZIL" | Country == "NEW ZEALAND" | Country == "BAHAMAS") %>%
  filter(Activity == "Surfing" | Activity == "Swimming" | Activity == "Unknown" | Activity == "Wading" | Activity == "Fishing" | Activity == "Standing") %>%
  ggplot(aes(x=Year,y=Activity, color = Country)) + geom_point()

dots

```


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  


//Not sure what to do with this group of data just yet
```{r}
newData <- aus_shark_data %>%
  group_by(Country) %>%
  summarize(numOfAttacks = n()) %>%
  arrange(desc(numOfAttacks)) %>%
  head()

newData

f <- aus_shark_data %>%
  group_by(Year, Country) %>%
  filter(Country == "USA" | Country == "AUSTRALIA" | Country == "SOUTH AFRICA" | Country == "BRAZIL" | Country == "NEW ZEALAND" | Country == "BAHAMAS") %>%
  summarize(attack = n()) %>%
  mutate(totalValue = (Country == "USA")*1946 + 1096 * (Country == "AUSTRALIA") + 497 *(Country == "SOUTH AFRICA") + 98 * (Country == "BRAZIL") + 
           87 * (Country == "NEW ZEALAND") + 84 * (Country =="BAHAMAS")) %>%
  ggplot(aes(x=Year, y=attack/totalValue)) + geom_bar(stat = "identity", color = "black", fill = "navyblue")+ facet_grid(Country ~ .) + geom_smooth(method = lm, color = "pink")

face # This is the graph we get after we just compare 
f #This is the graph we get afteer dividing the year by the total number of attacks for a given country
```

 
```{r}

std_month <- aus_shark_data %>%
  group_by(Year, Month) %>%
  summarize(number = n()) %>% 
  group_by(Month) %>%
  summarize(n = mean(number)) %>%
  ggplot(aes(x=Month, y = sd(n))) + geom_point()

avg_month <- aus_shark_data %>%
  group_by(Year, Month) %>%
  summarize(number = n()) %>%
  group_by(Month) %>%
  summarize(n = mean(number)) %>%
  ggplot(aes(x=Month, y = n, group = 1), levels = month.abb) + geom_point() + geom_line() +  scale_x_discrete(limits = month.abb)




avg_month

```
  
  
  //This isnt too useful i dont think
5. What month is the highest number of attacks in the USA?

```{r}
months <- aus_shark_data %>%
  filter(Country == "USA") %>%
  group_by(Month) %>%
  summarize(numOfAttacks = n()) %>%
  arrange(desc(Month)) %>%
  ggplot(aes(x=Month, y=numOfAttacks)) + geom_bar(stat = "identity", color = "black", fill = "navyblue") 

months
```
  
  
  
  
  
  
  
  
  
  
  